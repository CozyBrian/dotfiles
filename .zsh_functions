function nic() {
  local session_name="${1:-$(basename "$PWD")}"

  # If already inside tmux, don't nest
  if [[ -n "$TMUX" ]]; then
    echo "already in a tmux session. detach first or run from outside tmux."
    return 1
  fi

  # Attach if session already exists
  if tmux has-session -t "$session_name" 2>/dev/null; then
    tmux attach-session -t "$session_name"
    return
  fi

  # Create session (pane 1: will become neovim)
  tmux new-session -d -s "$session_name" -c "$PWD" -x "$(tput cols)" -y "$(tput lines)"

  # Split bottom for full-width terminal (20% height)
  tmux split-window -v -t "$session_name" -c "$PWD" -l 20%

  # Split the top pane right for opencode (30% width)
  tmux split-window -h -t "$session_name":1.1 -c "$PWD" -l 30%

  # Pane layout: 1=neovim (top-left), 2=opencode (top-right), 3=terminal (bottom)
  tmux send-keys -t "$session_name":1.1 "nvim ." C-m
  tmux send-keys -t "$session_name":1.2 "opencode" C-m

  # Focus on neovim pane
  tmux select-pane -t "$session_name":1.1

  tmux attach-session -t "$session_name"
}

function tic() {
  local session_name="${1:-$(basename "$PWD")}"

  if [[ -n "$TMUX" ]]; then
    echo "already in a tmux session. detach first or run from outside tmux."
    return 1
  fi

  if tmux has-session -t "$session_name" 2>/dev/null; then
    tmux attach-session -t "$session_name"
    return
  fi

  tmux new-session -d -s "$session_name" -c "$PWD" -x "$(tput cols)" -y "$(tput lines)"

  tmux split-window -h -t "$session_name" -c "$PWD" -l 40%
  tmux split-window -v -t "$session_name":1.2 -c "$PWD" -l 50%

  tmux send-keys -t "$session_name":1.1 "nvim ." C-m
  tmux send-keys -t "$session_name":1.2 "opencode" C-m

  tmux select-pane -t "$session_name":1.1

  tmux attach-session -t "$session_name"
}

function nic_layout() {
  if [[ -z "$TMUX" ]]; then
    echo "not in a tmux session. attach first."
    return 1
  fi

  local pane_path
  pane_path="$(tmux display-message -p "#{pane_current_path}")"
  local window_id
  window_id="$(tmux display-message -p "#{window_id}")"

  tmux kill-pane -a
  tmux split-window -v -c "$pane_path" -l 20%
  tmux split-window -h -t "$window_id".1 -c "$pane_path" -l 30%
  tmux send-keys -t "$window_id".1 "nvim ." C-m
  tmux send-keys -t "$window_id".2 "opencode" C-m
  tmux select-pane -t "$window_id".1
}

function tic_layout() {
  if [[ -z "$TMUX" ]]; then
    echo "not in a tmux session. attach first."
    return 1
  fi

  local pane_path
  pane_path="$(tmux display-message -p "#{pane_current_path}")"
  local window_id
  window_id="$(tmux display-message -p "#{window_id}")"

  tmux kill-pane -a
  tmux split-window -h -c "$pane_path" -l 40%
  tmux split-window -v -t "$window_id".2 -c "$pane_path" -l 50%
  tmux send-keys -t "$window_id".1 "nvim ." C-m
  tmux send-keys -t "$window_id".2 "opencode" C-m
  tmux select-pane -t "$window_id".1
}
